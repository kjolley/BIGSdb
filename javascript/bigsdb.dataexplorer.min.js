$(function(){$(".tablesorter").tablesorter({widgets:["zebra"]});$("#record_age_slider").slider({min:0,max:7,value:recordAge,slide:function(a,d){$("#record_age").html(recordAgeLabels[d.value])},change:function(a,d){$("#filter_age").html(recordAgeLabels[d.value]);recordAge=d.value;reloadTable()}});$("#include_old_versions").change(function(){reloadTable()});$("div#data_explorer").on("click touchstart",".expand_link",function(){var a=this.id.replace("expand_","");$("#"+a).hasClass("expandable_expanded")?
$("#"+a).switchClass("expandable_expanded","expandable_retracted data_explorer",1E3,"easeInOutQuad",function(){$("#expand_"+a).html('<span class="fas fa-chevron-down"></span>')}):$("#"+a).switchClass("expandable_retracted data_explorer","expandable_expanded",1E3,"easeInOutQuad",function(){$("#expand_"+a).html('<span class="fas fa-chevron-up"></span>')})});$("div#data_explorer").on("change",".option_check,.field_selector",function(){canAnalyse()?$("#analyse").removeClass("disabled"):$("#analyse").addClass("disabled")});
$("div#data_explorer").on("click touchstart","#analyse",function(){canAnalyse()&&runAnalysis()});canAnalyse()&&$("#analyse").removeClass("disabled")});function canAnalyse(){var a=!1;$(".option_check").each(function(){!0===this.checked&&(a=!0)});var d=!1;$(".field_selector").each(function(){""!==this.value&&(d=!0)});return a&&d}
function runAnalysis(){$("div#waiting").css("display","block");var a=[];$(".option_check").each(function(){if(!0===this.checked){var c=this.id;c=c.replace("v","");a.push(dataIndex[c])}});var d=[field];$(".field_selector").each(function(){""!==this.value&&d.push(this.value)});var c={fields:d,values:a,include_old_versions:$("#include_old_versions").is(":checked")?1:0,record_age:recordAge};$.ajax({url:url+"&page=explorer",type:"POST",data:{analyse:1,db:instance,page:"explorer",params:JSON.stringify(c)},
success:function(a){$("div#waiting").css("display","none");a=JSON.parse(a);d3.select("div#tree").select("svg").remove();d3.select("p#notes").style("display","block");d3.select("div#field_labels").html('<p style="margin-left:100px">'+a.fields.cleaned.join("</p><p>")+"</p>");loadTree(a)}})}
function reloadTable(){$("div#waiting").css("display","block");var a=$("#include_old_versions").is(":checked")?1:0;$.ajax({url:url+"&page=explorer&updateTable=1&field="+field+"&record_age="+recordAge+"&include_old_versions="+a}).done(function(a){var c=JSON.parse(a).html;$("div#table_div").html(c);$(".tablesorter").tablesorter({widgets:["zebra"]});$("div#waiting").css("display","none");c=(c.match(/value_row/g)||[]).length;$("span#unique_values").html(c);var d=0;$("td.value_count").each(function(){var a=
$(this).html().replace(",","");d+=parseInt(a,10)||0});$("span#total_records").html(commify(d));dataIndex=JSON.parse(a).index;$("#analyse").addClass("disabled");d3.select("div#tree").select("svg").remove()})}
function loadTree(a){function d(a){var g=d3.event&&d3.event.altKey?2500:250,e=c.descendants().reverse(),k=c.links();t(c);var l=c,q=c;c.eachBefore(function(b){b.x<l.x&&(l=b);b.x>q.x&&(q=b)});var h=q.x-l.x+f.top+f.bottom;g=m.transition().duration(g).attr("viewBox",[-f.left,l.x-f.top,p,h]).tween("resize",window.ResizeObserver?null:function(){return function(){return m.dispatch("toggle")}});e=u.selectAll("g").data(e,function(b){return b.id});h=e.enter().append("g").attr("transform",function(b){return"translate("+
a.y0+","+a.x0+")"}).attr("fill-opacity",0).attr("stroke-opacity",0);var n=d3.select("div#tooltip");h.append("circle").attr("r",8).attr("fill",function(b){return b._children?"#559":"#999"}).attr("stroke-width",10).attr("cursor","pointer").on("click",function(b,a){a.children=a.children?null:a._children;d(a)}).on("mouseover",function(b,a){null!=a._children&&n.html("Click to expand/contract").style("visibility","visible")}).on("mouseout",function(){n.style("visibility","hidden")});h.append("text").attr("dy",
"0.31em").attr("x",function(b){return b._children?-12:12}).attr("text-anchor",function(b){return b._children?"end":"start"}).text(function(b){return b.data.value&&25<b.data.value.length?b.data.value.substring(0,22)+"...":b.data.value}).attr("cursor","pointer").on("click touchstart",function(b,a){window.open(a.data.url)}).on("mouseover",function(b,a){n.html("Click to see records ("+a.data.count+")").style("visibility","visible")}).on("mouseout",function(){n.style("visibility","hidden")}).clone(!0).lower().attr("stroke-linejoin",
"round").attr("stroke-width",3).attr("stroke","white");h.filter(function(a){return a.parent}).append("rect").attr("width",function(a){return a.parent?100*a.data.count/a.parent.data.count:0}).attr("x",function(a){return a._children?-(100*a.data.count/a.parent.data.count)-12:12}).attr("y",function(a){return 6}).attr("height",function(a){return a.parent?1:0}).attr("stroke","blue");e.merge(h).transition(g).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}).attr("fill-opacity",1).attr("stroke-opacity",
1);e.exit().transition(g).remove().attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).attr("fill-opacity",0).attr("stroke-opacity",0);k=v.selectAll("path").data(k,function(a){return a.target.id});e=k.enter().append("path").attr("d",function(b){b={x:a.x0,y:a.y0};return r({source:b,target:b})});k.merge(e).transition(g).attr("d",r);k.exit().transition(g).remove().attr("d",function(b){b={x:a.x,y:a.y};return r({source:b,target:b})});c.eachBefore(function(a){a.x0=a.x;a.y0=a.y})}var c=d3.hierarchy(a.hierarchy).copy().sort(function(a,
c){return d3.descending(a.data.count,c.data.count)});a=a.fields.cleaned.length;var f={top:10,right:120,bottom:10,left:40},p=d3.select("div#tree").node().getBoundingClientRect().width;a=p/(a+1);var t=d3.tree().nodeSize([20,a]),r=d3.linkHorizontal().x(function(a){return a.y}).y(function(a){return a.x});c.x0=a/2;c.y0=0;c.descendants().forEach(function(a,c){a.id=c;a._children=a.children;0<a.depth&&(a.children=null)});var m=d3.select("div#tree").append("svg").attr("viewBox",[-f.left,-f.top,p,20]).style("font",
"13px sans-serif").style("user-select","none"),v=m.append("g").attr("fill","none").attr("stroke","#555").attr("stroke-opacity",.4).attr("stroke-width",1.5),u=m.append("g");d(c)}function commify(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};
//# sourceMappingURL=bigsdb.dataexplorer.min.js.map
