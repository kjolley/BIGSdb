var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;for(c=c||0;c<e;c++)if(b[c]==a||Object.is(b[c],a))return!0;return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var currentRequest=null,lastAjaxUpdate=(new Date).getTime(),ajaxDelay=1E3,MOBILE_WIDTH=480;
$(function(){showOrHideElements();$("select#add_field,label[for='add_field']").css("display","inline");var a=$("#fill_gaps").prop("checked"),b=$("#open_new").prop("checked");try{var c=(new Muuri("#dashboard",{dragEnabled:!0,layout:{fillGaps:a},dragStartPredicate:function(a,b){return enable_drag}})).on("move",function(){setGridMargins(c);saveLayout(c)});order&&loadLayout(c,order)}catch(d){console.log(d.message)}$("#record_age_slider").slider({min:0,max:7,value:recordAge,slide:function(a,b){$("#record_age").html(recordAgeLabels[b.value])},
change:function(a,b){$.ajax({url:url+"&page=dashboard&updateDashboard=1&attribute=record_age&value="+b.value}).done(function(a){$("#loaded_dashboard").val(JSON.parse(a).dashboard_name);$("#loaded_dashboard").prop("disabled",!1);$("#delete_dashboard").css("display","inline");$("#filter_age").html(recordAgeLabels[b.value]);reloadAllElements()})}});$("#panel_trigger,#close_trigger").click(function(){$("#modify_panel").toggle("slide",{direction:"right"},"fast");$("#panel_trigger").show();return!1});$("#panel_trigger").show();
$(document).mouseup(function(a){var b=$("#modify_panel");b.is(a.target)||0!==b.has(a.target).length||b.hide()});$("#fill_gaps").change(function(){a=$("#fill_gaps").prop("checked");try{c._settings.layout.fillGaps=a,c.layout()}catch(d){}$.ajax({url:url+"&page=dashboard&updateDashboard=1&attribute=fill_gaps&value="+(a?1:0)}).done(function(a){updateDashboardName(JSON.parse(a).dashboard_name)})});$("#enable_drag").change(function(){enable_drag=$("#enable_drag").prop("checked");$.ajax({url:url+"&page=dashboard&updateGeneralPrefs=1&attribute=enable_drag&value="+
(enable_drag?1:0)})});$("#edit_elements").change(function(){var a=$("#edit_elements").prop("checked");$.ajax(url+"&page=dashboard&updateGeneralPrefs=1&attribute=edit_elements&value="+(a?1:0));$("span.dashboard_edit_element").css("display",a?"inline":"none")});$("#remove_elements").change(function(){var a=$("#remove_elements").prop("checked");$.ajax(url+"&page=dashboard&updateGeneralPrefs=1&attribute=remove_elements&value="+(a?1:0));$("span.dashboard_remove_element").css("display",a?"inline":"none")});
$("#open_new").change(function(){b=$("#open_new").prop("checked");$.ajax({url:url+"&page=dashboard&updateGeneralPrefs=1&attribute=open_new&value="+(b?1:0)}).done(function(){reloadElementsWithURL()})});$("#include_old_versions").change(function(){var a=$("#include_old_versions").prop("checked");$.ajax({url:url+"&page=dashboard&updateDashboard=1&attribute=include_old_versions&value="+(a?1:0)}).done(function(b){updateDashboardName(JSON.parse(b).dashboard_name);$("#filter_versions").html(a?"all":"current");
reloadAllElements()})});$("#loaded_dashboard").change(function(){var a=$("#loaded_dashboard").val();a.length&&$.ajax(url+"&page=dashboard&updateDashboardName="+encodeURIComponent(a))});$("#switch_dashboard").change(function(){var a=$("#switch_dashboard").val();$.ajax({url:url+"&page=dashboard&setActiveDashboard="+a}).done(function(){location.reload()})});$("#add_element").click(function(){var a=getNextid();addElement(c,a);setGridMargins(c)});$("div#dashboard").on("click touchstart",".dashboard_edit_element",
function(){var a=$(this).attr("data-id");editElement(c,a)});$("div#dashboard").on("click touchstart",".dashboard_remove_element",function(){var a=$(this).attr("data-id");removeElement(c,a)});$("div#dashboard").on("click touchstart",".setup_element",function(){var a=$(this).attr("data-id");editElement(c,a)});$("div#dashboard").on("click touchstart",".dashboard_data_query_element",function(){var a=$(this).attr("data-id"),b=url+"&page=query";a=getDataQueryParams(a);post(b,a)});$("div#dashboard").on("click touchstart",
".dashboard_data_explorer_element",function(){var a=$(this).attr("data-id"),b=url+"&page=explorer";a=getDataExplorerParams(a);post(b,a)});applyFormatting();["width","height"].forEach(function(a){$(document).on("change","."+a+"_select",function(b){b=$(this).attr("id").replace("_"+a,"");changeElementDimension(c,b,a)})});$(document).on("change",".element_option",function(a){var b=$(this).attr("id");a=b.replace(/^\d+_/,"");b=b.replace("_"+a,"");var d;"hide_mobile"==a?(d=$(this).prop("checked"))?$("div#element_"+
b+" div.item-content").addClass("hide_mobile"):$("div#element_"+b+" div.item-content").removeClass("hide_mobile"):d=$(this).val();changeElementAttribute(c,b,a,d)});$(document).on("change",".palette_selector",function(a){a=$(this).attr("id");a=a.replace(/_palette$/,"");show_palette(a)});$(".multi_menu_trigger").on("click",function(){var a=this.id,b=a.replace("_trigger","_panel");"none"==$("#"+b).css("display")?($("#"+b).slideDown(),$("#"+a).html('<span class="fas fa-minus"></span>')):($("#"+b).slideUp(),
$("#"+a).html('<span class="fas fa-plus"></span>'))});$("a#dashboard_toggle").on("click",function(){$.get(url+"&page=dashboard&updateGeneralPrefs=1&attribute=default&value=0",function(){window.location=url})});$(window).resize(function(){showOrHideElements();setGridMargins(c);loadNewElements()});setGridMargins(c)});
function getDataQueryParams(a){var b={};elements[a].post_data&&(b=elements[a].post_data);b.page="query";b.db=instance;if(null!=elements[a].specific_values&&"specific values"==elements[a].visualisation_type){var c=elements[a].specific_values;b.list=Array.isArray(c)?c.join("\n"):c;b.attribute=elements[a].field}b.sent=1;$("#include_old_versions").prop("checked")&&(b.include_old="on");a=$("#record_age_slider").slider("value");0<a&&(b.prov_field1="f_date_entered",b.prov_operator1=">=",b.prov_value1=datestamps[a]);
return b}function getDataExplorerParams(a){var b={page:"explorer"};b.db=instance;b.field=elements[a].field;b.include_old_versions=$("#include_old_versions").prop("checked");b.record_age=$("#record_age_slider").slider("value");return b}function updateDashboardName(a){$("#loaded_dashboard").val(a);$("#loaded_dashboard").prop("disabled",!1);$("#delete_dashboard").css("display","inline")}
function setGridMargins(a){var b=155*Math.floor($("div#dashboard_panel").width()/155);$("div#dashboard").css("width",b);a.on("layoutEnd",function(){a.off("layoutEnd");var c=0;a.getItems().forEach(function(a){a=a.getPosition().left+a.getWidth();c=Math.max(c,a)});300>c&&(c=300);c+=10;c>b?$("div#dashboard").css("width",b):$("div#dashboard").css("width",c)})}
function showOrHideElements(){var a=$(window).width()<MOBILE_WIDTH;$("div.hide_mobile").css("display",a?"none":"block");$("div.hide_border").css("border",a?"0":"1px solid #ccc");$.each(elements,function(a,c){"setup"==c.display&&$("div#element_"+c.id+" div.item-content").css("display","block")})}
function post(a,b,c){c=void 0===c?"post":c;var d=document.createElement("form");d.method=c;d.action=a;for(var e in b)b.hasOwnProperty(e)&&(a=document.createElement("input"),a.type="hidden",a.name=e,a.value=b[e],d.appendChild(a));document.body.appendChild(d);d.submit()}function clean_value(a){if(null!=a)return Array.isArray(a)?(a=a.map(function(a){return a.trim()}),a=a.filter(function(a){return null!=a&&""!=a})):a=a.trim(),a}
function changeElementAttribute(a,b,c,d){elements[b][c]!==d&&("specific_values"!==c||Array.isArray(d)||(d=d.includes("\n")?d.split("\n"):d.split()),d=1==d||0==d?d?1:0:clean_value(d),elements[b][c]=d,saveAndReloadElement(a,b))}function applyFormatting(){fitty(".dashboard_big_number",{maxSize:64,observeMutations:!1});$(".item-content div.subtitle a").tooltip()}
function getNextid(){return 0===Object.keys(elements).length?1:Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(Object.keys(elements))))+1}
function addElement(a,b){0===Object.keys(elements).length&&$("div#empty").html("");var c=url+"&page=dashboard&new="+b,d=$("#add_field").val();d&&(c+="&field="+d);lastAjaxUpdate=(new Date).getTime();$.get(c,function(c){try{var d=document.createRange().createContextualFragment(JSON.parse(c).html);b in elements||(a.add([d.firstChild]),elements[b]=JSON.parse(c).element,saveElements(a));applyFormatting();showOrHideElements();$("div#element_"+b+" div.item-content").css("visibility","visible");updateDashboardName(JSON.parse(c).dashboard_name);
$("#delete_dashboard").css("display","inline")}catch(g){console.log(g.message)}})}
function editElement(a,b,c){$("span#control_"+b).hide();$("span#wait_"+b).show();$.get(url+"&page=dashboard&control="+b,function(c){$(c).appendTo("body").modal();$("#edit_elements").prop("checked")&&$("span#control_"+b).show();$("span#wait_"+b).hide();showOrHideControlElements(b);$("select.watermark_selector").fontIconPicker({theme:"fip-darkgrey",emptyIconValue:"none"});$("div.modal").on("change","#"+b+"_visualisation_type",function(){showOrHideControlElements(b);checkAndShowVisualisation(a,b)});
$("div.modal").on("change","#"+b+"_breakdown_display,#"+b+"_specific_value_display,#"+b+"_specific_values,#"+b+"_bar_colour_type",function(){showOrHideControlElements(b);checkAndShowVisualisation(a,b)});$("div.modal").on($.modal.AFTER_CLOSE,function(a,b){$("div.modal").remove()})})}
function showOrHideControlElements(a){var b=$("input[name='"+a+"_visualisation_type']:checked").val(),c=$("#"+a+"_specific_value_display").val(),d=$("#"+a+"_breakdown_display").val();$("fieldset#change_duration_control,fieldset#design_control,li#value_selector,li#breakdown_display_selector,li#specific_value_display_selector,li#top_value_selector,li#watermark_control,li#palette_control,li#text_colour_control,li#background_colour_control,li.gauge_colour,li#bar_colour_type,li#chart_colour").css("display","none");
"record_count"==elements[a].display?($("fieldset#change_duration_control,fieldset#design_control").css("display","inline"),$("li#text_colour_control,li#background_colour_control,li#watermark_control").css("display","block")):"seqbin_size"==elements[a].display?($("fieldset#design_control").css("display","inline"),$("li#chart_colour").css("display","block")):"specific values"===b?($("li#specific_value_display_selector,li#value_selector").css("display","block"),$("li#header_colour_control,li#header_background_colour_control").css("display",
"none"),"gauge"===c?($("fieldset#design_control").css("display","inline"),$("li.gauge_colour").css("display","block"),$("li#text_colour_control,li#background_colour_control").css("display","none")):"number"===c&&($("fieldset#change_duration_control,fieldset#design_control").css("display","inline"),$("li#watermark_control,li#text_colour_control,li#background_colour_control").css("display","block"))):"breakdown"===b&&($("li#breakdown_display_selector").css("display","block"),"bar"===d?($("fieldset#design_control,li#bar_colour_type").css("display",
"inline"),"continuous"===$("input[name='"+a+"_bar_colour_type']:checked").val()&&$("li#chart_colour").css("display","block")):"cumulative"===d?($("fieldset#design_control").css("display","inline"),$("li#chart_colour").css("display","block")):"map"===d?($("fieldset#design_control").css("display","inline"),$("li#palette_control").css("display","block"),show_palette(a)):"top"===d&&($("fieldset#design_control").css("display","inline"),$("li#top_value_selector,li#header_colour_control,li#header_background_colour_control").css("display",
"block")))}
function show_palette(a){var b={blue:colorbrewer.Blues[5],green:colorbrewer.Greens[5],purple:colorbrewer.Purples[5],orange:colorbrewer.Oranges[5],red:colorbrewer.Reds[5],"blue/green":colorbrewer.BuGn[5],"blue/purple":colorbrewer.BuPu[5],"green/blue":colorbrewer.GnBu[5],"orange/red":colorbrewer.OrRd[5],"purple/blue":colorbrewer.PuBu[5],"purple/blue/green":colorbrewer.PuBuGn[5],"purple/red":colorbrewer.PuRd[5],"red/purple":colorbrewer.RdPu[5],"yellow/green":colorbrewer.YlGn[5],"yellow/green/blue":colorbrewer.YlGnBu[5],"yellow/orange/brown":colorbrewer.YlOrBr[5],
"yellow/orange/red":colorbrewer.YlOrRd[5]};a=$("#"+a+"_palette").val();for(var c=0;5>c;c++)$("#palette_"+c).css("background",b[a][c])}
function checkAndShowVisualisation(a,b){var c=$("input[name='"+b+"_visualisation_type']:checked").val(),d=$("#"+b+"_breakdown_display").val(),e=$("#"+b+"_specific_value_display").val(),f=$("#"+b+"_specific_values").val();"specific values"===c?"0"!=e&&0!=f.length?(elements[b].display="field",elements[b].url=url+"&page=query",elements[b].url_text="Query records"):changeElementAttribute(a,b,"display","setup"):"breakdown"===c&&(0!=d?changeElementAttribute(a,b,"display","field"):changeElementAttribute(a,
b,"display","setup"))}function reloadElement(a){$.get(url+"&page=dashboard&element="+a,function(b){try{$("div#element_"+a+"> .item-content > .ajax_content").html(JSON.parse(b).html),elements[a]=JSON.parse(b).element,applyFormatting()}catch(c){console.log(c.message)}})}function reloadAllElements(){$.each(Object.keys(elements),function(a,b){reloadElement(b)})}
function reloadElementsWithURL(){$.each(Object.keys(elements),function(a,b){"specific values"!=elements[b].visualisation_type&&"top"==elements[b].breakdown_display&&reloadElement(b)})}function loadNewElements(){$.each(Object.keys(elements),function(a,b){loadedElements[b]||$(window).width()<MOBILE_WIDTH&&elements[b].hide_mobile||(reloadElement(b),loadedElements[b]=1)})}
function removeElement(a,b){var c=a.getItem($("div#element_"+b)[0]);a.remove([c],{removeElements:!0});delete elements[b];saveElements(a);0==Object.keys(elements).length&&$("div#empty").html(empty)}
function changeElementDimension(a,b,c){var d=$("div.item[data-id='"+b+"'] > div.item-content"),e=d.attr("class").split(/\s+/);$.each(e,function(a,b){b.includes("dashboard_element_"+c)&&d.removeClass(b)});e=$("input[name='"+b+"_"+c+"']:checked").val();d.addClass("dashboard_element_"+c+e);elements[b][c]=Number(e);saveAndReloadElement(a,b);a.refreshItems().layout()}
function saveElements(a){$.post(url,{db:instance,page:"dashboard",updateDashboard:1,attribute:"elements",value:JSON.stringify(elements)});saveLayout(a)}
function saveAndReloadElement(a,b){currentRequest=$.ajax({url:url,type:"POST",data:{db:instance,page:"dashboard",updateDashboard:1,attribute:"elements",value:JSON.stringify(elements)},beforeSend:function(){null!=currentRequest&&currentRequest.abort()},success:function(c){reloadElement(b);null!=a&&setGridMargins(a);updateDashboardName(JSON.parse(c).dashboard_name)}})}
function serializeLayout(a){a=a.getItems().map(function(a){return a.getElement().getAttribute("data-id")});return JSON.stringify(a)}function loadLayout(a,b){b=JSON.parse(b);for(var c=a.getItems(),d=c.map(function(a){return a.getElement().getAttribute("data-id")}),e=[],f,g=0;g<b.length;g++)f=b[g],f=d.indexOf(f),-1<f&&e.push(c[f]);a.sort(e,{layout:"instant"})}
function saveLayout(a){var b=0;(new Date).getTime()-lastAjaxUpdate<ajaxDelay&&(b=ajaxDelay);setTimeout(function(){lastAjaxUpdate=(new Date).getTime();var b=serializeLayout(a);$.ajax({url:url,type:"POST",data:{db:instance,page:"dashboard",updateDashboard:1,attribute:"order",value:b},success:function(a){$("#loaded_dashboard").val(JSON.parse(a).dashboard_name);$("#loaded_dashboard").prop("disabled",!1);$("#delete_dashboard").css("display","inline")}})},b)}
function resetDefaults(){$("#modify_panel").toggle("slide",{direction:"right"},"fast");$.get(url+"&resetDefaults=1",function(){location.reload()})}
function resetSeqbinRange(a){delete elements[a].min;delete elements[a].max;saveAndReloadElement(null,a);$.ajax({url:url+"&seqbin_range=1",type:"GET",success:function(a){a=JSON.parse(a).range;$("#seqbin_range_slider").slider("option","values",[a.min,a.max]);$("#seqbin_min").html(a.min);$("#seqbin_max").html(a.max);$("#reset_seqbin_range").css("display","none")}})}function createNew(){$.ajax({url:url+"&newDashboard=1",type:"GET",success:function(){location.reload()}})}
function commify(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};
//# sourceMappingURL=bigsdb.dashboard.min.js.map
