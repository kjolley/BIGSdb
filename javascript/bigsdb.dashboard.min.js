var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;for(c=c||0;c<e;c++)if(b[c]==a||Object.is(b[c],a))return!0;return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");var currentRequest=null;
$(function(){var a=$("#layout_test").prop("checked");$("select#add_field,label[for='add_field']").css("display",a?"none":"inline");var b=$("#layout").val(),c=$("#fill_gaps").prop("checked");try{var d=(new Muuri(".grid",{dragEnabled:!0,layout:{alignRight:b.includes("right"),alignBottom:b.includes("bottom"),fillGaps:c},dragStartPredicate:function(a,b){return enable_drag}})).on("move",function(){saveLayout(d)});order&&loadLayout(d,order)}catch(e){console.log(e.message)}$("#panel_trigger,#close_trigger").click(function(){$("#modify_panel").toggle("slide",
{direction:"right"},"fast");$("#panel_trigger").show();return!1});$("#panel_trigger").show();$(document).mouseup(function(a){var b=$("#modify_panel");b.is(a.target)||0!==b.has(a.target).length||b.hide()});$("#layout").change(function(){b=$("#layout").val();try{d._settings.layout.alignRight=b.includes("right"),d._settings.layout.alignBottom=b.includes("bottom"),d.layout()}catch(e){}$.ajax(url+"&page=dashboard&updatePrefs=1&attribute=layout&value="+b)});$("#fill_gaps").change(function(){c=$("#fill_gaps").prop("checked");
try{d._settings.layout.fillGaps=c,d.layout()}catch(e){}$.ajax(url+"&page=dashboard&updatePrefs=1&attribute=fill_gaps&value="+(c?1:0))});$("#enable_drag").change(function(){enable_drag=$("#enable_drag").prop("checked");$.ajax(url+"&page=dashboard&updatePrefs=1&attribute=enable_drag&value="+(enable_drag?1:0))});$("#edit_elements").change(function(){var a=$("#edit_elements").prop("checked");$.ajax(url+"&page=dashboard&updatePrefs=1&attribute=edit_elements&value="+(a?1:0));$("span.dashboard_edit_element").css("display",
a?"inline":"none")});$("#remove_elements").change(function(){var a=$("#remove_elements").prop("checked");$.ajax(url+"&page=dashboard&updatePrefs=1&attribute=remove_elements&value="+(a?1:0));$("span.dashboard_remove_element").css("display",a?"inline":"none")});$("#layout_test").change(function(){a=$("#layout_test").prop("checked");$.ajax(url+"&page=dashboard&updatePrefs=1&attribute=layout_test&value="+(a?1:0));$("select#add_field,label[for='add_field']").css("display",a?"none":"inline")});$("#include_old_versions").change(function(){var a=
$("#include_old_versions").prop("checked");$.ajax({url:url+"&page=dashboard&updatePrefs=1&attribute=include_old_versions&value="+(a?1:0)}).done(function(){reloadAllElements(d)})});$("#add_element").click(function(){var a=getNextid();addElement(d,a)});$("div#dashboard").on("click touchstart",".dashboard_edit_element",function(){var a=$(this).attr("data-id");editElement(d,a)});$("div#dashboard").on("click touchstart",".dashboard_remove_element",function(){var a=$(this).attr("data-id");removeElement(d,
a)});$("div#dashboard").on("click touchstart",".setup_element",function(){var a=$(this).attr("data-id");editElement(d,a)});$("div#dashboard").on("click touchstart",".dashboard_explore_element",function(){var a=$(this).attr("data-id");if(elements[a].url){var b=elements[a].url,c={};elements[a].post_data&&(c=elements[a].post_data);c.sent=1;b.includes("&page=query")&&$("#include_old_versions").prop("checked")&&(c.include_old="on");post(elements[a].url,c)}});applyFormatting();["width","height"].forEach(function(a){$(document).on("change",
"."+a+"_select",function(b){b=$(this).attr("id").replace("_"+a,"");changeElementDimension(d,b,a)})});$(document).on("change",".element_option",function(a){var b=$(this).attr("id");a=b.replace(/^\d+_/,"");b=b.replace("_"+a,"");changeElementAttribute(d,b,a,$(this).val())});$(".multi_menu_trigger").on("click",function(){var a=this.id,b=a.replace("_trigger","_panel");"none"==$("#"+b).css("display")?($("#"+b).slideDown(),$("#"+a).html('<span class="fas fa-minus"></span>')):($("#"+b).slideUp(),$("#"+a).html('<span class="fas fa-plus"></span>'))});
$("a#dashboard_toggle").on("click",function(){$.get(url+"&page=dashboard&updatePrefs=1&attribute=default&value=0",function(){window.location=url})})});function post(a,b){var c=$("<form></form>");c.attr("method","post");c.attr("action",a);$.each(b,function(a,b){var d=$("<input></input>");d.attr("type","hidden");d.attr("name",a);d.attr("value",b);c.append(d)});$(document.body).append(c);c.submit()}
function clean_value(a){if(null!=a)return Array.isArray(a)?(a=a.map(function(a){return a.trim()}),a=a.filter(function(a){return null!=a&&""!=a})):a=a.trim(),a}function changeElementAttribute(a,b,c,d){elements[b][c]!==d&&("specific_values"!==c||Array.isArray(d)||(d=d.includes("\n")?d.split("\n"):d.split()),d=clean_value(d),elements[b][c]=d,saveAndReloadElement(a,b))}
function applyFormatting(){fitty(".dashboard_big_number",{maxSize:64,observeMutations:!1});$(".item-content div.subtitle a").tooltip()}function getNextid(){return 0===Object.keys(elements).length?1:Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(Object.keys(elements))))+1}
function addElement(a,b){0===Object.keys(elements).length&&$("div#empty").html("");var c=url+"&page=dashboard&new="+b,d=$("#add_field").val();d&&(c+="&field="+d);$.get(c,function(c){try{var d=document.createRange().createContextualFragment(JSON.parse(c).html);b in elements||(a.add([d.firstChild]),elements[b]=JSON.parse(c).element,saveElements(a));applyFormatting()}catch(g){console.log(g.message)}})}
function editElement(a,b,c){$("span#control_"+b).hide();$("span#wait_"+b).show();$.get(url+"&page=dashboard&control="+b,function(c){$(c).appendTo("body").modal();$("#edit_elements").prop("checked")&&$("span#control_"+b).show();$("span#wait_"+b).hide();show_or_hide_control_elements(b);$("select.watermark_selector").fontIconPicker({theme:"fip-darkgrey",emptyIconValue:"none"});$("div.modal").on("change","#"+b+"_visualisation_type",function(){show_or_hide_control_elements(b);check_and_show_visualisation(a,
b)});$("div.modal").on("change","#"+b+"_breakdown_display,#"+b+"_specific_value_display,#"+b+"_specific_values,#"+b+"_bar_colour_type",function(){show_or_hide_control_elements(b);check_and_show_visualisation(a,b)});$("div.modal").on($.modal.AFTER_CLOSE,function(a,b){$("div.modal").remove()})})}
function show_or_hide_control_elements(a){var b=$("input[name='"+a+"_visualisation_type']:checked").val(),c=$("#"+a+"_specific_value_display").val(),d=$("#"+a+"_breakdown_display").val();$("fieldset#change_duration_control,fieldset#design_control,li#value_selector,li#breakdown_display_selector,li#specific_value_display_selector,li#top_value_selector,li#watermark_control,li#palette_control,li#text_colour_control,li#background_colour_control,li.gauge_colour,li#bar_colour_type,li#chart_colour").css("display","none");
"record_count"==elements[a].display?($("fieldset#change_duration_control,fieldset#design_control").css("display","inline"),$("li#text_colour_control,li#background_colour_control,li#watermark_control").css("display","block")):"specific values"===b?($("li#specific_value_display_selector").css("display","block"),"gauge"===c?($("fieldset#design_control").css("display","inline"),$("li#value_selector,li.gauge_colour").css("display","block")):"number"===c&&($("fieldset#change_duration_control,fieldset#design_control").css("display",
"inline"),$("li#watermark_control,li#text_colour_control,li#background_colour_control").css("display","block"))):"breakdown"===b&&($("li#breakdown_display_selector").css("display","block"),"bar"===d?($("fieldset#design_control,li#bar_colour_type").css("display","inline"),"continuous"===$("input[name='"+a+"_bar_colour_type']:checked").val()&&$("li#chart_colour").css("display","block")):"cumulative"===d?$("fieldset#design_control,li#chart_colour").css("display","inline"):"map"===d?$("fieldset#design_control,li#palette_control").css("display",
"inline"):"top"===d&&$("li#top_value_selector").css("display","inline"))}
function check_and_show_visualisation(a,b){var c=$("input[name='"+b+"_visualisation_type']:checked").val(),d=$("#"+b+"_breakdown_display").val(),e=$("#"+b+"_specific_value_display").val(),f=$("#"+b+"_specific_values").val();"specific values"===c?"0"!=e&&0!=f.length?(elements[b].display="field",elements[b].url=url+"&page=query",elements[b].url_text="Query records",elements[b].post_data={db:instance,page:"query",attribute:elements[b].field,list:Array.isArray(f)?f.join("\n"):f},saveAndReloadElement(a,
b)):changeElementAttribute(a,b,"display","setup"):"breakdown"===c&&(0!=d?(elements[b].display="field",saveAndReloadElement(a,b)):changeElementAttribute(a,b,"display","setup"))}function reloadElement(a,b){$.get(url+"&page=dashboard&element="+b,function(a){try{$("div#element_"+b+"> .item-content > .ajax_content").html(JSON.parse(a).html),elements[b]=JSON.parse(a).element,applyFormatting()}catch(d){console.log(d.message)}})}
function reloadAllElements(a){$.each(Object.keys(elements),function(b,c){reloadElement(a,c)})}function removeElement(a,b){var c=a.getItem($("div#element_"+b)[0]);a.remove([c],{removeElements:!0});delete elements[b];saveElements(a);0==Object.keys(elements).length&&$("div#empty").html(empty)}
function changeElementDimension(a,b,c){var d=$("div.item[data-id='"+b+"'] > div.item-content"),e=d.attr("class").split(/\s+/);$.each(e,function(a,b){b.includes("dashboard_element_"+c)&&d.removeClass(b)});e=$("input[name='"+b+"_"+c+"']:checked").val();d.addClass("dashboard_element_"+c+e);$("span#"+b+"_"+c).html(e);elements[b][c]=Number(e);saveAndReloadElement(a,b);a.refreshItems().layout()}
function saveElements(a){$.post(url,{db:instance,page:"dashboard",updatePrefs:1,attribute:"elements",value:JSON.stringify(elements)});saveLayout(a)}function saveAndReloadElement(a,b){currentRequest=$.ajax({url:url,type:"POST",data:{db:instance,page:"dashboard",updatePrefs:1,attribute:"elements",value:JSON.stringify(elements)},beforeSend:function(){null!=currentRequest&&currentRequest.abort()},success:function(){reloadElement(a,b)}})}
function serializeLayout(a){a=a.getItems().map(function(a){return a.getElement().getAttribute("data-id")});return JSON.stringify(a)}function loadLayout(a,b){b=JSON.parse(b);for(var c=a.getItems(),d=c.map(function(a){return a.getElement().getAttribute("data-id")}),e=[],f,g=0;g<b.length;g++)f=b[g],f=d.indexOf(f),-1<f&&e.push(c[f]);a.sort(e,{layout:"instant"})}function saveLayout(a){a=serializeLayout(a);$.post(url,{db:instance,page:"dashboard",updatePrefs:1,attribute:"order",value:a})}
function resetDefaults(){$("#modify_panel").toggle("slide",{direction:"right"},"fast");$.get(url+"&resetDefaults=1",function(){$("#layout").val("left-top");$("#fill_gaps").prop("checked",!0);$("#enable_drag").prop("checked",!1);$("#edit_elements").prop("checked",!1);$("#remove_elements").prop("checked",!1);location.reload()})}function commify(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};
//# sourceMappingURL=bigsdb.dashboard.min.js.map
